    <!DOCTYPE html>
    <meta charset="utf-8">
    <title>Clasificados a través de los años</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <style>
    .title{
	font-size: 18px;
	font-family: Helvetica,sans-serif;
	display: inline-block;
    }

    .square{
	background:green;
	height: 12px;
	width: 12px;
    }

    .legend{
	width: 150px;
	height: 170px;
	align:left;
	position: absolute;
	padding: 10px;
	top: 200px;
	left: 600px;
	border: 1px solid #00F500;
	font-size: 10px;
	font-family: Helvetica,sans-serif;
    }

    .map{
	top: 400px;
	left: 400px;
	// border: 2px solid #00F500;   
    }

    .hover{
	border: 1px solid #CCC;
    }

    .normal{
	borde: 0px; 	
    }  

    .tooltip1 {
	background: #eee;
	box-shadow: 0 0 5px #999999;
	color: #333;
	display: none;
	font-size: 12px;
	left: 130px;
	padding: 10px;
	position: absolute;
	text-align: center;
	top: 95px;
	width: 80px;
	z-index: 10;
    }

    .tooltip2 {   
	position: relative;           
	text-align: center;           
	width: 60px;                  
	height: 28px;
	display: none;  
	padding: 2px;             
	font: 12px sans-serif;        
	background: lightsteelblue;   
	border: 0px;      
	border-radius: 8px;           
	pointer-events: none;         
    }

    .tooltip3 {
	position: absolute;
	text-align: left;
	width: 140px;
	padding: 10px;
	font-size: 10px;
	font-family: Helvetica,sans-serif;
	background: none repeat scroll 0% 0% rgb(255, 255, 255);
	pointer-events: none;
	display: none;
	border: 1px solid #CCC;
    }

</style>
    <div class="container">
    <label 	for="year" 
	style="display: inline-block; width: 240px; text-align: right">
    Año = <span id="year-value">1998</span>
    </label>
    <input class="title" type="range" min="1998" max="2014" id="year">
    <button>Animar</button>
    </div>

    <script src="d3.v3.min.js"></script>
    <script>

//cargando el svg inicial
var svg_file1 = "Blank_Argentina_Map_color.svg";
// var svg_file2 = "legend.svg";

var svg_node = d3.select("svg");

var n_provinces = 44;

var div1 = d3.select("body")
    .attr("class","map")
    .append("div")   
    .attr("class", "tooltip3");

var html_legend = "<div><form>"+
 "<fieldset>"+
 "<legend>Personalia:</legend>"+
 "<div class='square'></div>Name:<br>"+
 "<div class='square'></div>Email:<br>"+
 "<div class='square'></div>Date of birth:"+
 "</fieldset>"+
 "</form></div>"; 
 
// var html_legend = "<div>Leyenda"+
    // "<div class='row'>"+
    // "<div class='col-sm-1'><div class='square'></div></div><p class='col-sm-1'> + de 100</p></div>"+
    // "<div class='row'>"+
    // "<div class='col-sm-1'><div class='square'></div></div><p class='col-sm-1'> + de 100</p></div>"+
    // "</div>";		
	
var div2 = d3.select("body").append("div")
    .attr("class","container")
    .html(html_legend)
    .attr("class","legend"); 

var play_label = "Animar";

var play = d3.select("button").on('click',function()
	{
		for(var j=1998;j<2015;j++)
		{
			// alert(this);
			update_svg(j,"button");
			// svg_node.transition().delay(1000).duration(1000);
		}
	});
	


var path_to_provs = 
    {
	path2413:"Buenos Aires",
	path3180:"Catamarca",
	path3189:"Chaco",
	path3194:"Chubut",
	path2265:"Ciudad Autónoma de Buenos Aires",
	path3195:"Corrientes",
	path3166:"Córdoba",
	path3201:"Entre Ríos",
	FO:"Formosa",
	path3185:"Jujuy",
	path3164:"La Pampa",
	path3178:"La Rioja",
	path3174:"Mendoza",
	path3228:"Misiones",
	path3172:"Neuquén",
	path2388:"Río Negro",
	path3182:"Salta",
	path3176:"San Juan",
	path3170:"San Luis",
	path3192:"Santa Cruz",
	path3224:"Santa Fe",
	path3193:"Santiago del Estero",
	path2384:"Tierra del Fuego",
	path3187:"Tucumán",
    };			

d3.xml(svg_file1, "image/svg+xml", function(xml)
       {
	   document.body.appendChild(xml.documentElement);	
       });
// d3.xml(svg_file2, "image/svg+xml", function(xml)
       // {
	   // document.body.appendChild(xml.documentElement);	
       // });


//adicionando leyenda
// d3.select("svg").append("g");

//asociando el slider al mapa...
d3.select("#year").on("input", function(){update_svg(+this.value,"input");});

function tooltip(year,id,event)
{
    d3.select("#"+id).style('stroke-width', 2)
	.style('stroke', 'steelblue');
    d3.csv("clasificados/provcounts.csv",function(rows)
	   {
	       rows.map(function(d)
			{
			    if(d.Año == year && d.Provincia == path_to_provs[id]){
				div1.html("<p><b>Año:</b> "+d.Año+"</p>"+
					  "<p><b>Provincia:</b> "+d.Provincia+"</p>"+
					  "<p>"+d.Cantidad+" clasificados</p>")
				    .style('top',  event.pageY + 'px')
				    .style('left', event.pageX + 'px')
				    .style('display', 'block');
			    }
			});
	   });
    
}

function update_svg(year,caller)
{
    //actualizando slider
    d3.select("#year-value").text(year);
    d3.select("#year").property("year", year);
    div1.style('display', 'none');
    
    //leyendo archivo svg correspondiente al año
    var svg = "clasificados/mapa"+year+".svg";
    // var svg = "mapa"+year+".svg";
    
    var xml = d3.xml(svg,"image/svg+xml", function(xml)
	   {
	       
	       for(i = 0; i < n_provinces; i++){
		   
		   //actualizando los colores
		   path = d3.selectAll("path")[0][i];
		   
		   // alert(path.id);
		   //path.style.fill = xml.documentElement.getElementById(path.id).style.fill; 
		   d3.select(path).transition().style('fill',xml.documentElement.getElementById(path.id).style.fill);
		   
		   //asociando el tooltip por provincia y año
		   d3.select(path).on('mouseenter',function(event)
				      {
					  tooltip(year,this.id,d3.event);
				      }).on('mouseout',function(event)
					    {
						d3.select("#"+this.id).style('stroke-width', 1)
						    .style('stroke', 'white');
					    });
	       } 
	   });
	   
	   // if (caller == "button")
	   // {
			// svg_node.transition().delay(1000).duration(1000);
	   // }
}
</script>

